<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UCCN伪代码报错分析 | AI提示词生成</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            width: 95%;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
            overflow: hidden;
            margin: 0 auto;
            padding: 30px 25px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: #2c3e50;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 400;
        }

        .header p {
            font-size: 1.1em;
            color: #666;
        }

        .input-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 25px;
        }

        @media (max-width: 768px) {
            .input-section {
                grid-template-columns: 1fr;
                gap: 15px;
            }
        }

        .input-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            border: 1px solid #e1e8ed;
        }

        .input-card h3 {
            color: #2c3e50;
            font-size: 1.3em;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .input-card h3 i {
            color: #3498db;
        }

        textarea {
            width: 100%;
            min-height: 120px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 14px;
            resize: vertical;
            transition: border-color 0.3s ease;
        }

        textarea:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }

        .prompt-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 12px;
            border: 1px solid #e1e8ed;
            margin-bottom: 25px;
            text-align: center;
        }

        .prompt-section h3 {
            color: #2c3e50;
            font-size: 1.3em;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
            justify-content: center;
        }

        .prompt-section h3 i {
            color: #9b59b6;
        }

        .btn-group {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 0;
        }

        .btn {
            color: white;
            border: none;
            padding: 14px 30px;
            border-radius: 30px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }

        .btn-generate {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
        }

        .btn-copy {
            background: linear-gradient(135deg, #27ae60 0%, #229954 100%);
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        }

        .toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: #27ae60;
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 9999;
        }

        .toast.show {
            opacity: 1;
        }

        .footer {
            text-align: center;
            margin-top: 30px;
            color: #666;
            font-size: 1em;
        }

        .footer a {
            color: #3498db;
            text-decoration: none;
            font-weight: 500;
        }

        .footer a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 头部 -->
        <div class="header">
            <h1><i class="fas fa-bug"></i> UCCN伪代码报错分析助手</h1>
            <p>自动生成AI提示词，快速定位伪代码错误位置及原因</p>
        </div>

        <!-- 输入区域 -->
        <div class="input-section">
            <div class="input-card">
                <h3><i class="fas fa-code"></i> 伪代码</h3>
                <textarea id="pseudo-code" placeholder="请粘贴你的UCCN伪代码..."></textarea>
            </div>

            <div class="input-card">
                <h3><i class="fas fa-file-code"></i> 编译结果</h3>
                <textarea id="compile-result" placeholder="请粘贴伪代码编译后的Python代码..."></textarea>
            </div>

            <div class="input-card">
                <h3><i class="fas fa-play-circle"></i> 函数调用</h3>
                <textarea id="function-call" placeholder="请粘贴函数调用语句（如：test(1,2)）..."></textarea>
            </div>

            <div class="input-card">
                <h3><i class="fas fa-exclamation-triangle"></i> 运行结果/报错信息</h3>
                <textarea id="run-result" placeholder="请粘贴运行结果或报错信息..."></textarea>
            </div>
        </div>

        <!-- AI提示词操作区域（仅保留按钮） -->
        <div class="prompt-section">
            <h3><i class="fas fa-robot"></i> AI提示词生成</h3>
            
            <div class="btn-group">
                <button class="btn btn-generate" onclick="generatePrompt()">
                    <i class="fas fa-magic"></i> 生成提示词
                </button>
                <button class="btn btn-copy" onclick="copyPrompt()">
                    <i class="fas fa-copy"></i> 复制提示词
                </button>
            </div>
        </div>

        <!-- 页脚 -->
        <div class="footer">
            <p>© 2025 UCCN伪代码助手 | <a href="https://github.com/calcury/pseudo-code-compilation" target="_blank">GitHub开源</a></p>
        </div>
    </div>

    <!-- 提示框 -->
    <div class="toast" id="toast">复制成功！</div>

    <script>
        // 存储生成的提示词（不显示在页面）
        let generatedPrompt = '';

        // Flask App代码模板（可根据实际情况修改）
        const flaskAppCode = `
from flask import Flask, request, jsonify, send_file
import subprocess
import tempfile
import os
import re

app = Flask(__name__)

# 读取func.py文件的内容
def read_func_py():
    func_path = os.path.join(os.path.dirname(__file__), 'func.py')
    try:
        with open(func_path, 'r', encoding='utf-8') as f:
            return f.read()
    except FileNotFoundError:
        return ""
    except Exception as e:
        print(f"读取func.py时出错: {e}")
        return ""

def pseudo_to_python(pseudo_code):
    # 中文标点转换表
    cn_punct_map = {
        '（': '(',
        '）': ')',
        '：': ':',
        '；': ';',
        '，': ',',
        '。': '.',
        '！': '!',
        '【': '[',
        '】': ']',
        '&&': 'and',
        '||': 'or',
        'mod': '%',
        '–': '-'
    }

    # 统一替换中文标点
    for cn, en in cn_punct_map.items():
        pseudo_code = pseudo_code.replace(cn, en)
    lines = pseudo_code.split('\\n')
    python_lines = []
    indent_level = 0
    in_else_block = False

    for i, line in enumerate(lines):
        original_line = line
        line = line.rstrip()  # 保留行首空格
        line = re.sub(r'^\\s*\\d+\\s*:\\s*', '', line) #strip number
        if not line.strip():  # 空行
            continue

        if re.match(r'^(Require|Requires|Returns|Return)\\s*:.*$', line, re.IGNORECASE):
            continue

        # True/False 自动替换
        line = re.sub(r'\\btrue\\b', 'True', line, flags=re.IGNORECASE)
        line = re.sub(r'\\bfalse\\b', 'False', line, flags=re.IGNORECASE)

        line = re.sub(r'\\bif\\b', 'if', line, flags=re.IGNORECASE)
        line = re.sub(r'\\belse\\b', 'else', line, flags=re.IGNORECASE)
        line = re.sub(r'\\belseif\\b', 'elseif', line, flags=re.IGNORECASE)
        line = re.sub(r'\\breturn\\b', 'return', line, flags=re.IGNORECASE)
        line = re.sub(r'\\bendif\\b', 'endif', line, flags=re.IGNORECASE)
        line = re.sub(r'\\blet\\b', 'let', line, flags=re.IGNORECASE)

        # 处理函数定义
        func_match = re.match(r'^Algorithm:\\s*(\\w+)\\((.*?)\\)', line, re.IGNORECASE)
        if func_match:
            func_name = func_match.group(1)
            params = func_match.group(2)
            python_lines.append(f"def {func_name}({params}):")
            indent_level = 1
            continue
        # 其他函数定义处理逻辑...

    final_code = '\\n'.join(python_lines)
    return final_code

@app.route('/compile', methods=['POST'])
def compile_code():
    try:
        data = request.json
        pseudo_code = data.get('pseudo_code', '')
        func_code = read_func_py()
        pseudo_python_code = pseudo_to_python(pseudo_code)
        final_python_code = f"{func_code}\\n\\n{pseudo_python_code}" if func_code else pseudo_python_code

        return jsonify({
            'success': True,
            'python_code': final_python_code,
            'message': '编译成功'
        })
    except Exception as e:
        return jsonify({
            'success': False,
            'error': str(e),
            'python_code': ''
        })

@app.route('/run', methods=['POST'])
def run_code():
    try:
        data = request.json
        pseudo_code = data.get('pseudo_code', '')
        function_call = data.get('function_call', '')
        # 运行逻辑...
        return jsonify({
            'success': True,
            'output': output,
            'converted_python': full_code
        })
    except Exception as e:
        return jsonify({
            'success': False,
            'error': str(e)
        })

if __name__ == "__main__":
    app.run(debug=True)
        `;

        // 生成AI提示词（存储在变量中，不显示）
        function generatePrompt() {
            // 获取输入内容
            const pseudoCode = document.getElementById('pseudo-code').value.trim();
            const compileResult = document.getElementById('compile-result').value.trim();
            const functionCall = document.getElementById('function-call').value.trim();
            const runResult = document.getElementById('run-result').value.trim();

            // AI提示词模板
            const aiPromptTemplate = `
请帮我分析以下UCCN伪代码的错误问题：

### 1. 原始UCCN伪代码
${pseudoCode || '未提供'}

### 2. 编译后的Python代码
${compileResult || '未提供'}

### 3. 函数调用语句
${functionCall || '未提供'}

### 4. 运行结果/报错信息
${runResult || '未提供'}

### 5. 相关Flask处理代码
${flaskAppCode.trim()}

请你：
1. 指出伪代码中的具体错误位置和原因
2. 分析编译/运行报错的根本原因
3. 提供修正后的伪代码
4. 解释修正思路和UCCN伪代码规范要求
5. 说明如何避免类似错误

要求：回答要详细、易懂，适合算法初学者理解。
            `.trim();

            // 存储生成的提示词
            generatedPrompt = aiPromptTemplate;
            
            // 可选：生成后给出提示
            const toast = document.getElementById('toast');
            toast.textContent = "提示词生成成功！";
            toast.classList.add('show');
            setTimeout(() => {
                toast.classList.remove('show');
            }, 2000);
        }

        // 复制提示词
        function copyPrompt() {
            // 检查是否已生成提示词
            if (!generatedPrompt) {
                const toast = document.getElementById('toast');
                toast.textContent = "请先生成提示词！";
                toast.style.background = "#e74c3c";
                toast.classList.add('show');
                setTimeout(() => {
                    toast.classList.remove('show');
                    toast.style.background = "#27ae60";
                }, 2000);
                return;
            }
            
            // 创建临时文本区域复制内容
            const tempTextArea = document.createElement('textarea');
            tempTextArea.value = generatedPrompt;
            document.body.appendChild(tempTextArea);
            tempTextArea.select();
            document.execCommand('copy');
            document.body.removeChild(tempTextArea);

            // 显示复制成功提示
            const toast = document.getElementById('toast');
            toast.textContent = "复制成功！";
            toast.classList.add('show');
            setTimeout(() => {
                toast.classList.remove('show');
            }, 2000);
        }

        // 页面加载初始化
        window.onload = function() {
            generatedPrompt = '';
        };
    </script>
</body>
</html>